%   Perform update with linear KF and Gaussian models
%   
%   Input: Previous states Xprev, measurement model F, 
%   motion variance matrix P, measurement covariance R and measurement z
%
%   Output: Predicted states X and predicted covariance matrix P
%
%
%
%
%
%%

function [X,P] = kalmanfilterUpd(Xprev,H, P, R, z)

S = H*P*H'+R; % create inovation matrix S
K = P*H'*inv(S); % calculate kalman gain
v = z - H*Xprev; % 
X = Xprev+K*v;
P = P - K*S*K';

end